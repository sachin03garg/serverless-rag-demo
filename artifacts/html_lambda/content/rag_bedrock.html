<!DOCTYPE html>
<!-- saved from url=(0062)https://5fzlbtf429.execute-api.us-east-1.amazonaws.com/dev/rag -->
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- <meta http-equiv="Content-Type" content="text/html; charset=windows-1252"> -->
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes"> -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
    integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <link rel="shortcut icon" href="#" />
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
    integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
    crossorigin="anonymous"></script>
  <style>
    .toast-config {
      width: 25vw;
      margin-left: 76vw;
      z-index: 1000;
      position: absolute;
    }

    .header {
      background-color: #001529;
      color: white;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      justify-content: center;
    }

    body,
    html {
      width: 100%;
      height: 100%;
    }

    body {
      margin: 0;
      padding: 0;
      /* background:#29b6f6; */
      /* #c8cbcf */
      background: #dee6ef;
    }

    .bubbles {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: -100;
      overflow: hidden;
      top: 0;
      left: 0;
    }

    .bubble {
      position: absolute;
      bottom: -100px;
      width: 40px;
      height: 40px;
      background: #5b6471b5;
      border-radius: 50%;
      opacity: 0.1;
      animation: rise 10s infinite ease-in;
    }

    .bubble:nth-child(1) {
      width: 40px;
      height: 40px;
      left: 10%;
      animation-duration: 8s;
    }

    .bubble:nth-child(2) {
      width: 20px;
      height: 20px;
      left: 20%;
      animation-duration: 5s;
      animation-delay: 1s;
    }

    .bubble:nth-child(3) {
      width: 50px;
      height: 50px;
      left: 35%;
      animation-duration: 7s;
      animation-delay: 2s;
    }

    .bubble:nth-child(4) {
      width: 80px;
      height: 80px;
      left: 50%;
      animation-duration: 11s;
      animation-delay: 0s;
    }

    .bubble:nth-child(5) {
      width: 35px;
      height: 35px;
      left: 55%;
      animation-duration: 6s;
      animation-delay: 1s;
    }

    .bubble:nth-child(6) {
      width: 45px;
      height: 45px;
      left: 65%;
      animation-duration: 8s;
      animation-delay: 3s;
    }

    .bubble:nth-child(7) {
      width: 90px;
      height: 90px;
      left: 70%;
      animation-duration: 12s;
      animation-delay: 2s;
    }

    .bubble:nth-child(8) {
      width: 25px;
      height: 25px;
      left: 80%;
      animation-duration: 6s;
      animation-delay: 2s;
    }

    .bubble:nth-child(9) {
      width: 15px;
      height: 15px;
      left: 70%;
      animation-duration: 5s;
      animation-delay: 1s;
    }

    .bubble:nth-child(10) {
      width: 90px;
      height: 90px;
      left: 25%;
      animation-duration: 10s;
      animation-delay: 4s;
    }

    @keyframes rise {
      0% {
        bottom: -100px;
        transform: translateX(00);
      }

      50% {
        transform: translate(100px);
      }

      100% {
        bottom: 1080px;
        transform: translateX(-200px);
      }
    }

    .conversations .gradient-custom {
      /* fallback for old browsers */
      background: #fccb90 !important;

      /* Chrome 10-25, Safari 5.1-6 */
      background: -webkit-linear-gradient(to bottom right, rgba(252, 203, 144, 1), rgba(213, 126, 235, 1)) !important;

      /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
      background: linear-gradient(to bottom right, rgba(252, 203, 144, 1), rgba(213, 126, 235, 1)) !important
    }

    .screen_divider {
      max-width: 400px;
      width: 100%;
      padding: 30px;
      border-radius: 30px;
    }

    .image_viewer {
      max-width: 50vw;
      width: 100%;
      background: #fff;
      padding: 5px;
      border-radius: 30px;

      .img-area {
        position: relative;
        width: 100%;
        height: 70vh;
        background: #c8effb;
        /* margin-bottom: 30px; */
        border-radius: 15px;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      .file-img-area {
        height: 42vh;
        position: relative;
        background: #c8effb;
        /* margin-bottom: 30px; */
        border-radius: 15px;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      .file-img-area .icon,.img-area .icon {
        font-size: 100px;
      }

      .file-img-area h3,.img-area h3 {
        font-size: 20px;
        font-weight: 500;
        margin-bottom: 6px;
      }

      .file-img-area p,.img-area p {
        color: #999;
      }

      .file-img-area p span,.img-area p span {
        font-weight: 200;
      }

      .file-img-area object,.img-area object {
        position: relative;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        width: 100%;
        height: 100%;
        z-index: 100;
      }

      .file-img-area::before,.img-area::before {
        content: attr(data-img);
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* background: rgba(0, 0, 0, .5); */
        color: #232523;
        font-size: 30px;
        font-weight: 600;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        pointer-events: none;
        /* opacity: 0; */
        transition: all .3s ease;
        z-index: 200;
      }

      .img-area.active:hover::before {
        opacity: 50;
      }
      .file-img-area.active:hover::before {
        opacity: 50;
      }

      .select-file,.select-image {
        display: block;
        width: 100%;
        padding: 5px 0;
        margin-top: 5px;
        border-radius: 15px;
        /* color: #fff; */
        font-weight: 500;
        font-size: 16px;
        cursor: pointer;
      }

      .remove-file,.remove-image {
        display: block;
        width: 100%;
        padding: 5px 0;
        margin-top: 5px;
        border-radius: 15px;
        /* color: #fff; */
        font-weight: 500;
        font-size: 16px;
        cursor: pointer;
      }

    }


    .conversations .mask-custom {
      background: rgba(24, 24, 16, .2) !important;
      border-radius: 2em;
      backdrop-filter: blur(15px);
      border: 2px solid rgba(255, 255, 255, 0.05) !important;
      background-clip: padding-box !important;
      box-shadow: 10px 10px 10px rgba(46, 54, 68, 0.03) !important;
    }
  </style>


</head>

<body>
  <!-- <div class="p-3 mb-2 bg-light text-dark"> -->
  <div id="alert-placeholder"></div>
  <div class="header">
    <h1><span id="model-name">Llama2-7b<span></h1>

  </div>

  <section class="sticky">
    <div class="bubbles">
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>
      <div class="bubble"></div>

    </div>
  </section>

  <div style="padding-bottom: 10px;"></div>
  <div style="padding-bottom: 10px;"></div>

  <div class="modal-sm text-muted" style="margin-left: 30vw;" tabindex="-1" id="apikey_modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Set API Key</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="password" id="api_key" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="setApiKey()">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <div id="main-bedrock-content">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="index-tab" data-bs-toggle="tab" data-bs-target="#index-div" type="button"
          role="tab" aria-controls="Index" aria-selected="true" data-toggle="tooltip">Index Documents</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="query-tab" data-bs-toggle="tab" data-bs-target="#query-div" type="button"
          role="tab" aria-controls="Query" aria-selected="false">Query Data</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="conversations-tab" data-bs-toggle="tab" data-bs-target="#conversations-div"
          type="button" role="tab" aria-controls="Conversations" aria-selected="false">Conversations</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="weather-tab" data-bs-toggle="tab" data-bs-target="#weather-agents-div"
          type="button" role="tab" aria-controls="Weather Agent" aria-selected="false">Weather Agent</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="hotel-tab" data-bs-toggle="tab" data-bs-target="#hotel-agents-div" type="button"
          role="tab" aria-controls="Hotel Agent" aria-selected="false">Hotel Agent</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="index-div" role="tabpanel" aria-labelledby="index-tab">
        <div style="padding-bottom: 10px;"></div>
        <div class="alert alert-primary" role="alert">
          Index your documents here. The refresh interval for indexes is approximately 60 seconds
        </div>
        <div style="padding-bottom: 10px;"></div>
        <div class="container">
          <div class="row">
            <div class="col-lg-8">
              <h4>Index Custom Documents</h4>
            </div>
            <div class="col">
              <h4>Index Sample Data</h4>
            </div>
          </div>

          <div class="row">
            <div class="col-lg-6">
              <!-- Image viewer component -->
              <div id="file_viewer_container" style="height:52vh;">

                <div class="image_viewer" style="height: 50vh;">
                  <input type="file" id="index-file" accept=".txt, .json, .csv, .pdf" hidden multiple>
                  <div class="file-img-area" data-img="">
                    <div id="file_guidance">
                      <i class='bx bxs-cloud-upload icon'></i>
                      <h3>Upload File pdf/json/csv/txt</h3>
                      <p>File size must be less than <span>10MB</span></p>
                    </div>
                  </div>
                  <div class="row"></div>
                  <div class="row">
                    <div class="col-md-4">
                      <button class="select-file btn-secondary btn-sm">Select File</button>
                    </div>
                    <div class="col-md-4">
                      <button class="remove-file btn-close btn-sm">Remove File</button>
                    </div>
                  </div>


                </div>

              </div>
              <!-- Image viewer component ends -->
            </div>
            <div class="col-lg-2"></div>
            <div class="col-lg-4">
              <div class="row">
                <button id="sample-movie" type="button" class="btn-sm btn-warning"
                  onclick="javascript:indexSampleDocument('movie')">Index a new movie (Enigma's Pursuit)</button>
              </div>
              <div class="row" style="padding-top: 15px;"></div>
              <div class="row">
                <button id="sample-isro" type="button" class="btn-sm btn-warning"
                  onclick="javascript:indexSampleDocument('isro')">Index ISRO missions (Aditya-L1,
                  Chandrayan-3)</button>
              </div>
              <div class="row" style="padding-top: 15px;"></div>
              <div class="row">
                <button id="sample-finance" type="button" class="btn-sm btn-warning"
                  onclick="javascript:indexSampleDocument('amazon_earnings')">Index Amazon Earnings Report (Quarterly
                  Results)</button>
              </div>
            </div>

          </div>
          <div class="row">
            <div class="col">
              <button id="index-button" type="button" class="btn btn-info" onclick="javascript:get_to_s3_presigned()">Index
                Documents</button>
            </div>
            <div class="col">
              <button id="delete-button" type="button" class="btn btn-danger"
                onclick="javascript:reset()">Reset</button>
            </div>
            <div class="col-sm-1"></div>
            <div class="col-sm-1"></div>
          </div>

        </div>


        <div class="d-flex justify-content-center" id="index-spinner">
          <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="query-div" role="tabpanel" aria-labelledby="query-tab">
        <div class='row'>
          <div class="col-lg-12" id="query_viewer_details">
            <div class="row">
              <div style="padding-bottom: 10px;"></div>
              <div class="alert alert-primary" role="alert">
                Once you've indexed documents, you can query your data here
              </div>
              <div class="dropdown" style="padding-left: 20px; padding-bottom: 10px;">
                <button class="btn btn-info btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
                  aria-expanded="false">
                  Select Model on Amazon Bedrock
                </button>
                <ul class="dropdown-menu">
                  <!-- Anthropic -->
                  <li><a class="dropdown-item"
                      onclick="model_selected('anthropic.claude-3-haiku-20240307-v1:0')">Anthropic
                      Claude-3 Haiku (New)</a></li>
                  <li><a class="dropdown-item"
                      onclick="model_selected('anthropic.claude-3-sonnet-20240229-v1:0')">Anthropic
                      Claude-3 Sonnet (New)</a></li>
                  <li><a class="dropdown-item" onclick="model_selected('anthropic.claude-v2:1')">Anthropic Claude
                      V2.1</a>
                  </li>
                  <li><a class="dropdown-item" onclick="model_selected('anthropic.claude-v2')">Anthropic Claude V2</a>
                  </li>
                  <li><a class="dropdown-item" onclick="model_selected('anthropic.claude-instant-v1')">Anthropic Claude
                      Instant</a></li>
                  <li><a class="dropdown-item" onclick="model_selected('meta.llama2-13b-chat-v1')">Meta Llama2-13B
                      (Experimental)</a></li>
                  <li><a class="dropdown-item" onclick="model_selected('meta.llama2-70b-chat-v1')">Meta Llama2-70B
                      (Experimental)</a></li>
                </ul>
                <span id="set_model"></span>
                <div class="d-flex justify-content-center" id="custom-spinner">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>

              </div>
            </div>
            <div class="row">
              <div class="col"></div>
              <div class="col">
                <input type="checkbox" id="q_vectordb" name="q_vectordb" checked value="kbase">
                <label for="q_vectordb">Query Knowledge Base</label>
              </div>
            </div>
            <div class="row" style="padding-left: 20px;">
              <div class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp" alt="avatar 3"
                  style="width: 40px; height: 100%;">
                <textarea id="query" type="text" class="form-control form-control-lg"
                  placeholder="Query your data here"></textarea>
              </div>
            </div>
            <div class="row">
              <div id="query-button" style="padding-left: 20px;" data-toggle="tooltip"
                title="Select an Amazon Bedrock Model to continue" data-placement="left">
                <button type="button" id="english" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('english')">English</button>
                <button type="button" id="hindi" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('hindi')">Hindi</button>
                <button type="button" id="thai" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('thai')">Thai</button>
                <button type="button" id="spanish" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('spanish')">Spanish</button>
                <button type="button" id="french" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('french')">French</button>
                <button type="button" id="german" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('german')">German</button>
                <button type="button" id="bengali" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('bengali')">Bengali</button>
                <button type="button" id="tamil" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('tamil')">Tamil</button>
                <button type="button" id="tamil" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('arabic')">Arabic</button>
                  <button type="button" id="italian" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('italian')">Italian</button>
                <button type="button" id="sentiment" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('sentiment')">Sentiment Analysis</button>
                <button type="button" id="pii" class="btn btn-info assistant btn-sm"
                  onclick="javascript:query('pii')">Identify
                  PII</button>
                <button type="button" id="redact" class="btn btn-info btn-sm assistant"
                  onclick="javascript:query('redact')">Redact
                  PII</button>
                <button type="button" id="clear" class="btn btn-info btn-sm" onclick="clear_response()">Clear
                  Output</button>
              </div>
            </div>

            <div class="row">
              <div style="padding-left: 10px;">

                <table>
                  <tr>
                    <td>
                      <div>
                        <!-- <textarea id="query-response" name="response" rows="10" cols="100" placeholder="query response" readonly=""></textarea> -->
                        <div class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
                          <textarea id="query-response" type="text" cols="500" rows="9"
                            class="form-control form-control-lg" placeholder="Query response here"></textarea>
                        </div>


                      </div>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          <div class="col" id="image_viewer_details">
            <!-- Image Viewer component -->
            <div id="image_viewer_container">

              <div class="image_viewer">
                <input type="file" id="file" accept=".png, .jpg, .txt, .json, .csv, .pdf, .xls, .xlsx" hidden multiple>
                <div class="img-area" data-img="">
                  <div id="image_guidance">
                    <i class='bx bxs-cloud-upload icon'></i>
                    <h3>Upload File png/jpg/txt/json/pdf</h3>
                    <p>Image size must be less than <span>2MB</span></p>
                  </div>
                </div>
                <div class="row"></div>
                <div class="row">
                  <div class="col">
                    <button class="select-image btn-primary btn-sm">Select File</button>
                  </div>
                  <div class="col">
                    <button class="remove-image btn-warning btn-sm">Remove File</button>
                  </div>
                </div>


              </div>

            </div>
            <!-- Image Viewer component end -->
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="conversations-div" role="tabpanel" aria-labelledby="conversations-tab"
        style="margin-top:-5vh">
        <!-- style="background-color: #eee;" -->
        <section class="gradient-custom">
          <div class="container py-5">

            <div class="row d-flex justify-content-center">
              <div class="col-md-12 col-lg-12 col-xl-12">

                <div class="card" id="chat2">
                  <div class="card-header d-flex justify-content-between align-items-center p-3">
                    <h5 class="mb-0">Chat</h5>
                    <button type="button" class="btn btn-primary btn-sm" data-mdb-ripple-color="dark"
                      onclick="showChatBox()">Start a new chat session</button>
                  </div>
                  <div id="conversations-box" class="card-body" data-mdb-perfect-scrollbar="true"
                    style="position: relative; height: 60vh; overflow-x: hidden; overflow-y: auto;">
                    <!-- Assistant -->
                    <div class="d-flex flex-row justify-content-start">
                      <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                        alt="avatar 1" style="width: 45px; height: 100%;">
                      <div>
                        <p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">
                          Hello I am Claude V2</p>
                      </div>
                    </div>

                    <!-- <div class="divider d-flex align-items-center mb-4">
                      <p class="text-center mx-3 mb-0" style="color: #a2aab7;">Today</p>
                    </div> -->

                    <!-- Human -->
                    <!-- <div class="d-flex flex-row justify-content-end mb-4 pt-1">
                  <div>
                    <p class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary">Hello, how are you doing</p>
                    <p class="small me-3 mb-3 rounded-3 text-muted d-flex justify-content-end">00:06</p>
                  </div>
                  <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava4-bg.webp"
                    alt="avatar 1" style="width: 45px; height: 100%;">
                </div> -->

                  </div>
                  <div id="conversations-footer"
                    class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"
                      alt="avatar 3" style="width: 40px; height: 100%;">
                    <input type="text" class="form-control form-control-lg" id="chat-text" placeholder="Type message">
                    <button id="send-chat-button" type="button" class="btn btn-info"
                      onclick="sendChat('chat')">send</button>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </section>

      </div>

      <div class="tab-pane fade" id="weather-agents-div" role="tabpanel" aria-labelledby="weather-agents-tab"
        style="margin-top:-5vh">
        <!-- style="background-color: #eee;" -->
        <section class="gradient-custom">
          <div class="container py-5">

            <div class="row d-flex justify-content-center">
              <div class="col-md-12 col-lg-12 col-xl-12">

                <div class="card" id="chat2">
                  <div class="card-header d-flex justify-content-between align-items-center p-3">
                    <h5 class="mb-0">Chat</h5>
                    <button type="button" class="btn btn-primary btn-sm" data-mdb-ripple-color="dark"
                      onclick="reset_agent_box('weather')">Start a new chat session</button>
                  </div>
                  <div id="weather-conversations-box" class="card-body" data-mdb-perfect-scrollbar="true"
                    style="position: relative; height: 60vh; overflow-x: hidden; overflow-y: auto;">
                    <!-- Assistant -->
                    <div class="d-flex flex-row justify-content-start">
                      <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                        alt="avatar 1" style="width: 45px; height: 100%;">
                      <div>
                        <p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">
                          Welcome to Weather reporter</p>
                      </div>
                    </div>

                  </div>
                  <div id="conversations-footer"
                    class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"
                      alt="avatar 3" style="width: 40px; height: 100%;">
                    <input type="text" class="form-control form-control-lg" id="weather-chat-text"
                      placeholder="Type message">
                    <button id="send-chat-button" type="button" class="btn btn-info"
                      onclick="invokeAgent('weather')">send</button>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </section>

      </div>

      <div class="tab-pane fade" id="hotel-agents-div" role="tabpanel" aria-labelledby="hotel-agents-tab"
        style="margin-top:-5vh">
        <!-- style="background-color: #eee;" -->
        <section class="gradient-custom">
          <div class="container py-5">

            <div class="row d-flex justify-content-center">
              <div class="col-md-12 col-lg-12 col-xl-12">

                <div class="card" id="chat2">
                  <div class="card-header d-flex justify-content-between align-items-center p-3">
                    <h5 class="mb-0">Chat</h5>
                    <button type="button" class="btn btn-primary btn-sm" data-mdb-ripple-color="dark"
                      onclick="reset_agent_box('hotel')">Start a new chat session</button>
                  </div>
                  <div id="hotel-conversations-box" class="card-body" data-mdb-perfect-scrollbar="true"
                    style="position: relative; height: 60vh; overflow-x: hidden; overflow-y: auto;">
                    <!-- Assistant -->
                    <div class="d-flex flex-row justify-content-start">
                      <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"
                        alt="avatar 1" style="width: 45px; height: 100%;">
                      <div>
                        <p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">
                          Welcome to SunNSands room booking portal</p>
                      </div>
                    </div>

                  </div>
                  <div id="conversations-footer"
                    class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"
                      alt="avatar 3" style="width: 40px; height: 100%;">
                    <input type="text" class="form-control form-control-lg" id="hotel-chat-text"
                      placeholder="Type message">
                    <button id="send-chat-button" type="button" class="btn btn-info"
                      onclick="invokeAgent('hotel')">send</button>
                  </div>
                </div>

              </div>
            </div>

          </div>
        </section>

      </div>


      <div id="err"></div>

      <div id="sse"></div>
    </div>
  </div>
  <!-- </div> -->


  <footer>
    <script type="text/javascript">
      var model_name = 'Llama2-7B'
      var vector_text = ' with Opensearch Serverless vector db demo'
      var showChat = false;
      // do stuff
      $(document).ready(function () {
        $('#main-bedrock-content').hide();
        $('#apikey_modal').css('top', '12vh')
        $('#apikey_modal').show()
        $('#custom-spinner').css('visibility', 'hidden');
        $('#index-spinner').css('visibility', 'hidden');
        $('#index-tab').prop('disabled', true);
        $('#index-tab').prop('title', 'Enable Amazon Opensearch serverless to index documents for RAG');
        $('#index-div').css('visibility', 'hidden');
        document.getElementById("model-name").innerHTML = awsData.htmlheader + vector_text
        $("button.assistant").prop('disabled', true)
        $('[data-toggle="tooltip"]').tooltip();
        $('[id^=agent-]').hide()

        // Image upload code start
        $('#image_viewer_details').hide();
        $('#image_viewer_container').hide();
        const selectImage = document.querySelector('.select-image');
        const removeImage = document.querySelector('.remove-image');

        const inputFile = document.querySelector('#file');
        const imgArea = document.querySelector('.img-area');

        const selectFile = document.querySelector('.select-file');
        const removeFile = document.querySelector('.remove-file');
        const inputIndexFile = document.querySelector('#index-file');
        const fileImgArea = document.querySelector('.file-img-area');

        selectFile.addEventListener('click', function () {
          base64File = []
          fileImgArea.dataset.img = ''
          inputIndexFile.value = '';
          inputIndexFile.click();
          $('#file_guidance').hide();
        })

        removeFile.addEventListener('click', function () {
          $('#file_guidance').show();
          const allImg = fileImgArea.querySelectorAll('object');
          allImg.forEach(item => item.remove());
          base64File = []
          fileImgArea.dataset.img = ''
        })

        inputIndexFile.addEventListener('change', function () {

          if (this.files && this.files.length > 0) {
            const allImg = fileImgArea.querySelectorAll('object');
            allImg.forEach(item => item.remove());
            for (var j = 0; j < this.files.length; j++) {
              const file = this.files[j];
              if (file.size < 10000000) {
                const reader = new FileReader()

                reader.onload = () => {
                  const imgUrl = reader.result;
                  base64File.push(imgUrl)
                  const img = document.createElement('object');
                  //img.src = imgUrl;
                  img.data = imgUrl;
                  fileImgArea.appendChild(img);
                  fileImgArea.classList.add('active');
                  if (fileImgArea.dataset.img) {
                    fileImgArea.dataset.img = fileImgArea.dataset.img + ', ' + file.name;
                  } else {
                    fileImgArea.dataset.img = file.name;
                  }

                }
                reader.readAsDataURL(file);

              } else {
                alertbuilder("File size should be less than 10MB." + file.name + ' was not added', false);
              }
            }

          }
        });


      // On Query Tab
      selectImage.addEventListener('click', function () {
        inputFile.value = '';
        base64Image = []
        imgArea.dataset.img = ''
        inputFile.click();
        $('#image_guidance').hide();
      })

      removeImage.addEventListener('click', function () {
        $('#image_guidance').show();
        const allImg = imgArea.querySelectorAll('object');
        allImg.forEach(item => item.remove());
        base64Image = []
        imgArea.dataset.img = ''
      })


      inputFile.addEventListener('change', function () {

        if (this.files && this.files.length > 0) {
          const allImg = imgArea.querySelectorAll('object');
          allImg.forEach(item => item.remove());
          for (var j = 0; j < this.files.length; j++) {
            const file = this.files[j];
            if (file.size < 5000000) {
              const reader = new FileReader()

              reader.onload = () => {
                const imgUrl = reader.result;
                base64Image.push(imgUrl)
                const img = document.createElement('object');
                //img.src = imgUrl;
                img.data = imgUrl;
                imgArea.appendChild(img);
                imgArea.classList.add('active');
                if (imgArea.dataset.img) {
                  imgArea.dataset.img = imgArea.dataset.img + ', ' + file.name;
                } else {
                  imgArea.dataset.img = file.name;
                }

              }
              reader.readAsDataURL(file);

            } else {
              alertbuilder("File size should be less than 5MB." + file.name + ' was not added', false);
            }
          }

        }
        // Image upload code end
      });

      });

      var model_id = null;
      var base64Image = [];
      var base64File = [];
      var ws = null;
      var chat_id = null;
      var awsData = {
        apiGatewayUrl: '<apiGatewayUrl>',
        staticPageUrl: '<apiGatewayUrl>',
        htmlheader: '<htmlheader>',
        websocketUrl: '<websocketUrl>',
        isRagEnabled: '<isRagEnabled>'
      };


      function setApiKey() {
        api_key = $('#api_key').val()
        if (api_key) {
          awsData['apiKey'] = api_key
          $('#apikey_modal').hide()
          $.ajaxSetup({
            headers: { 'x-api-key': api_key }
          });
          $('#main-bedrock-content').show();

          if (awsData.isRagEnabled == 'yes') {
            $('#index-tab').prop('disabled', false);
            $('#index-tab').prop('title', 'Index documents in Amazon Opensearch serverless');
            $("#index-div").css('visibility', 'visible');
            $("#index-tab").click();
          } else {
            $('#index-tab').prop('disabled', true);
            $('#index-tab[data-toggle="tooltip"]').tooltip()
            $('#index-div').css('visibility', 'hidden');
            $("#query-tab").click()


          }
        } else {
          alertbuilder('Please add an API Key to proceed', false)
        }
      }

      function build_url(result) {
        url = result['url']
        url = url.substring(0, url.length - 1) + '?';
        file_data = {}
        if ('fields' in result) {
          for(var key in result['fields']) {
            url = url + key + '=' + result['fields'][key] + '&'
          }
        }
        return url
      }

      function build_form_data(result, formdata) {
        if ('fields' in result) {
          for(var key in result['fields']) {
            formdata.append(key, result['fields'][key])
          }
        }
        return formdata
      }

      function base64ToArrayBuffer(base64) {
        var binaryString = atob(base64);
        var bytes = new Uint8Array(binaryString.length);
        for (var i = 0; i < binaryString.length; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        // return bytes.buffer;
        return new File([bytes], 'sample')
      }

      function get_to_s3_presigned() {

        for (var i=0; i< base64File.length; i++) {
          file_extension = ''
          content = base64File[i]
          file_type = content.substring("data:".length, content.indexOf(";base64"))
          if (file_type.includes('/')) {
              file_extension = file_type.split('/')[1]
          } else {
              file_extension = file_type
          }

          $('#index-spinner').css('visibility', 'visible');
          $('#index-button').css('visibility', 'hidden');
          $('#delete-button').css('visibility', 'hidden');

          $.ajax({
          type: "GET",
          url: awsData.apiGatewayUrl + '/get-presigned-url',
          contentType: "text/json",
          dataType: 'json',
          data: {"file_extension": file_extension},
          contentType: "application/json",
          success: function (result) {
            alertbuilder('Uploading to S3', true)
            var formData = new FormData();
            formData = build_form_data(result['result'], formData)
            content = content.replace(/^data:.+;base64,/, "")
            // content = atob(content)
            bytes = base64ToArrayBuffer(content)
            formData.append('file', bytes);
            $.ajax({
                type: "POST",
                url: result['result']['url'],
                data: formData,
                processData: false,
                contentType: false,
                contentEncoding: 'base64',
                success: function (res) {
                  alertbuilder('Uploaded file '+ i +' to S3', true)
                  indexDocuments(result['result']['fields']['key'], i)
                },
                error: function(err) {
                  $('#index-spinner').css('visibility', 'hidden');
                  $('#index-button').css('visibility', 'visible');
                  $('#query-button').css('visibility', 'visible');
                  $('#delete-button').css('visibility', 'visible');
                  alertbuilder('Document Not Indexed', false)
                  console.log(err)
                }
              });
          },
          error: function (err) {
            $('#index-spinner').css('visibility', 'hidden');
            $('#index-button').css('visibility', 'visible');
            $('#query-button').css('visibility', 'visible');
            $('#delete-button').css('visibility', 'visible');
            console.log('Error on making API gateway call to index documents ..');
            console.log(err.responseText);
            console.log(err)
            alertbuilder(err.responseText.replaceAll('"', ''), false)
          }
        });

        }



      }

      function indexDocuments(s3_key, i) {

        $('#index-spinner').css('visibility', 'visible');
        $('#index-button').css('visibility', 'hidden');
        $('#delete-button').css('visibility', 'hidden');
        //Retrieve list of dashboards that the user can access from QuickSight.
        $.ajax({
          type: "POST",
          url: awsData.apiGatewayUrl + '/detect-text',
          contentType: "text/json",
          dataType: 'json',
          data: JSON.stringify({ "s3_key": s3_key }),
          success: function (result) {
            if (typeof result['result'] != 'string' && 'jobId' in result['result']) {
              alertbuilder('Indexing request for file '+ i +' sent:' + result['result']['jobId'], true)
              interval_retry_counter = 0
              job_id = result['result']['jobId']
              indexing_checker = setInterval(() => {
              interval_retry_counter = interval_retry_counter + 1
                 get_job_status(job_id, function(result) {
                  if (result['statusCode']=='200' && result['result'] == true) {
                    $.ajax({
                      type: "POST",
                      url: awsData.apiGatewayUrl + '/index-files',
                      contentType: "text/json",
                      dataType: "json",
                      data: JSON.stringify({"jobId": job_id}),
                      success: function(res) {
                        $('#index-spinner').css('visibility', 'hidden');
                        $('#index-button').css('visibility', 'visible');
                        $('#query-button').css('visibility', 'visible');
                        $('#delete-button').css('visibility', 'visible');
                        alertbuilder('Document Indexed Successfully', true)
                        clearInterval(indexing_checker)
                      },
                      error: function(err) {
                        $('#index-spinner').css('visibility', 'hidden');
                        $('#index-button').css('visibility', 'visible');
                        $('#query-button').css('visibility', 'visible');
                        $('#delete-button').css('visibility', 'visible');
                        alertbuilder("Document Not Indexed", false)
                        clearInterval(indexing_checker)
                        // alertbuilder(err.responseText.replaceAll('"', ''), false)
                      }
                    });
                  }
                  else if (result['statusCode']=='200' && result['result'] != true) {
                    alertbuilder('Document Indexing In-progress', true)
                  }
                  else if (result['statusCode']=='400'){
                    $('#index-spinner').css('visibility', 'hidden');
                    $('#index-button').css('visibility', 'visible');
                    $('#query-button').css('visibility', 'visible');
                    $('#delete-button').css('visibility', 'visible');

                    alertbuilder('Document Not Indexed', false)
                    clearInterval(indexing_checker)
                  }
                  if (interval_retry_counter > 30) {
                    $('#index-spinner').css('visibility', 'hidden');
                    $('#index-button').css('visibility', 'visible');
                    $('#query-button').css('visibility', 'visible');
                    $('#delete-button').css('visibility', 'visible');

                    alertbuilder('Indexing status IN_Progress after 1 minute of waiting', false)
                    clearInterval(indexing_checker)
                 }
                 });

              }, 5000)

            } else {
              $('#index-spinner').css('visibility', 'hidden');
              $('#index-button').css('visibility', 'visible');
              $('#query-button').css('visibility', 'visible');
              $('#delete-button').css('visibility', 'visible');
              alertbuilder(result['result'], true)
            }
          },
          error: function (err) {
            $('#index-spinner').css('visibility', 'hidden');
            $('#index-button').css('visibility', 'visible');
            $('#query-button').css('visibility', 'visible');
            $('#delete-button').css('visibility', 'visible');
            alertbuilder('Document Not Indexed', false)
            console.log(err)
          }
        });
      }

      function get_job_status(jobId, callback) {

        $.ajax({
          type: "GET",
          url: awsData.apiGatewayUrl + '/get-job-status',
          contentType: "text/json",
          dataType: 'json',
          data: { "jobId": jobId },
          success: function (result) {
            return callback(result)
          },
          error: function (err) {
            console.log('Error on making API gateway call to index documents ..');
            console.log(err.responseText);
            console.log(err)
            return callback(result)
          }
        });

      }


      function clear_response() {
        // document.getElementById('query-response').innerHTML = '';
        $('#query-response').html('');
      }

      function reset() {
        $('#index-spinner').css('visibility', 'visible');
        $('#index-button').css('visibility', 'hidden');
        $('#query-button').css('visibility', 'hidden');
        $('#delete-button').css('visibility', 'hidden');
        $('#response').css('visibility', 'hidden');
        $.ajax({
          type: "DELETE",
          url: awsData.apiGatewayUrl + '/index-documents',
          contentType: "text/json",
          dataType: 'json',
          success: function (result) {
            $('#response').val(result['result'])
            $('#index-spinner').css('visibility', 'hidden');
            $('#index-button').css('visibility', 'visible');
            $('#query-button').css('visibility', 'visible');
            $('#delete-button').css('visibility', 'visible');
            alertbuilder(result['result'], true)

          },
          error: function (err) {
            $('#index-spinner').css('visibility', 'hidden');
            $('#index-button').css('visibility', 'visible');
            $('#query-button').css('visibility', 'visible');
            $('#delete-button').css('visibility', 'visible');
            console.log('Error on making API gateway call to delete index..');
            console.log(err.responseText);
            alertbuilder(err.responseText.replaceAll('"', ''), false)
          }
        });

      }

      function alertbuilder(message, success) {
        var alert_css = 'alert-danger'
        if (success) {
          alert_css = 'alert-success'
        }
        $('#alert-placeholder').append('<div id="alertdiv" class="alert ' + alert_css + ' toast-config"><a class="close" data-dismiss="alert"></a><span>' + message + '</span></div>')
        setTimeout(() => {
          $('#alertdiv').remove();
        }, 5000)
      }

      function model_selected(val) {
        $('#set_model').text('Model selected : ' + val)

        if (val.startsWith('anthropic.claude-3-')) {
          // Enable image uploads
          $('#image_viewer_container').show();
          $('#image_viewer_details').show();
          $('#image_viewer_details').addClass('col-lg-3')
          $('#query_viewer_details').addClass('col-lg-9')
          $('#query_viewer_details').removeClass('col-lg-12')

        } else {
          $('#image_viewer_container').hide();
          $('#image_viewer_details').hide();
          $('#image_viewer_details').removeClass('col-lg-3')
          $('#query_viewer_details').removeClass('col-lg-9')
          $('#query_viewer_details').addClass('col-lg-12')
        }

        model_id = val
        alertbuilder('Model Selected: ' + val, true)
        $("button.assistant").prop('disabled', false)
      }

      function indexSampleDocument(type) {
        $('#index-spinner').css('visibility', 'visible');
        $('#index-button').css('visibility', 'hidden');
        $('#query-button').css('visibility', 'hidden');
        $('#delete-button').css('visibility', 'hidden');
        $.ajax({
          type: "POST",
          url: awsData.apiGatewayUrl + '/index-sample-data',
          contentType: "text/json",
          dataType: 'json',
          data: JSON.stringify({ "type": type }),
          success: function (result) {
            $('#index-spinner').css('visibility', 'hidden');
            $('#index-button').css('visibility', 'visible');
            $('#query-button').css('visibility', 'visible');
            $('#delete-button').css('visibility', 'visible');
            alertbuilder('Indexed Successfully', true)
          },
          error: function (err) {
            $('#index-spinner').css('visibility', 'hidden');
            $('#index-button').css('visibility', 'visible');
            $('#query-button').css('visibility', 'visible');
            $('#delete-button').css('visibility', 'visible');
            console.log('Error on making API gateway call to index documents ..');
            console.log(err.responseText);
            var err_message = err.responseText
            if (err.status == 403) {
              err_message = 'Incorrect API Key ' + err_message
            }
            alertbuilder(err_message.replaceAll('"', ''), false)
          }
        });

      }

      function hasWhiteSpace(s) {
        return /\s/g.test(s);
      }


      // Query with file content. Used for anthropic-claude-3 models
      function query(assistant_type) {
        $('#custom-spinner').css('visibility', 'visible');
        $('#index-button').css('visibility', 'hidden');
        $('#query-button').css('visibility', 'hidden');
        $('#delete-button').css('visibility', 'hidden');

        document.getElementById('query-response').innerHTML = document.getElementById('query-response').innerHTML + '\n' + assistant_type.toUpperCase() + ': \n'

        user_query = []
        upload_workflow = false
        if (model_id.startsWith('anthropic.claude-3-')) {
          for (var i = 0; i < base64Image.length; i++) {
            upload_workflow = true
            b64_img = base64Image[i]
            upload_to_s3(b64_img, function (result) {
              if (result) {
                alertbuilder('Uploaded file ' + i + ' to S3', true)
                file_type = b64_img.substring("data:".length, b64_img.indexOf(";base64"))
                if (file_type.includes('/')) {
                  file_extension = file_type.split('/')[1]
                } else {
                  file_extension = file_type
                }

                if (b64_img.includes('image')) {
                  user_query.push({ 'type': 'image', 'data': result['result']['file_id'], 'file_extension': result['result']['file_extension'], 'file_type': 'image/' + result['result']['file_extension'] })
                } else {
                  user_query.push({ 'type': 'other', 'data': result['result']['file_id'], 'file_extension': result['result']['file_extension'], 'file_type': file_type })
                }
              } else {
                alertbuilder('File ' + i + ' wasnt successfully uploaded', false)
              }


            });
          }
        }



        if (upload_workflow) {
          interval_retry_counter = 0
          upload_checker_interval = setInterval(() => {
            interval_retry_counter = interval_retry_counter + 1
            if (user_query.length >= base64Image.length) {
              generate_and_send_query(user_query, assistant_type, model_id)
              clearInterval(upload_checker_interval)
            } else if (interval_retry_counter > 60) {
              alertbuilder('All images were not uploaded within ' + (60) + ' secs', false)
              // After 10 seconds of waiting clear out the interval
              generate_and_send_query(user_query, assistant_type, model_id)
              clearInterval(upload_checker_interval)
            }
          }, 1000)

        } else {
          generate_and_send_query(user_query, assistant_type, model_id)
          user_query = []
        }

      }

      function generate_and_send_query(user_query, assistant_type, model_id) {
        query_str = " " + $('#query').val()
        user_query.push({ 'type': 'text', 'data': query_str })
        query_vector_db = 'no'
        if ($('#q_vectordb').is(":checked")){
          query_vector_db = 'yes'
        }
        data = '{"query": "' + btoa(JSON.stringify(user_query)) + '", "query_vectordb": "' + query_vector_db + '", "behaviour": "' + assistant_type + '", "model_id": "' + model_id + '" ,"action": "bedrock"}'
        send_over_websocket(data, 'query-response')
      }

      function send_over_websocket(data, dom_id) {
        if ("WebSocket" in window) {
          console.log("WebSocket is supported by your Browser!");
          if (ws == null || ws.readyState == 3 || ws.readyState == 2) {
            ws = new WebSocket(awsData.websocketUrl + '?x-api-key=' + awsData['apiKey']);
            ws.onerror = function (event) {
              console.log(event);
              $('#custom-spinner').css('visibility', 'hidden');
              $('#index-button').css('visibility', 'visible');
              $('#query-button').css('visibility', 'visible');
              $('#delete-button').css('visibility', 'visible');
              alertbuilder('Could not establish connection. Either Incorrect key or exceeded usage limits', false)
            }

          } else {
            ws.send(data);
          }

          ws.onopen = function () {
            ws.send(data);
          }

        }

        ws.onmessage = function (evt) {
          $('#custom-spinner').css('visibility', 'hidden');
          $('#index-button').css('visibility', 'visible');
          $('#query-button').css('visibility', 'visible');
          $('#delete-button').css('visibility', 'visible');
          var received_msg = '';
          response_json = {}
          try {
            response_json = JSON.parse(atob(evt.data))
          }
          catch (error) {
            console.log(error)
          }
          if ("text" in response_json) {
            str_len = -1
            try {
              str_len = response_json['text'].trim().length
            } catch (error) {
              console.log('str_len error')
            }
            if (str_len != 0) {
              received_msg = response_json['text']
            }
          } else {
            received_msg = JSON.stringify(response_json)
          }
          console.log("streaming message is received.. " + received_msg);
          document.getElementById(dom_id).innerHTML = document.getElementById(dom_id).innerHTML + received_msg

        }
      }

      function upload_to_s3(file, callback) {
        unique_id = crypto.randomUUID()
        $.ajax({
          type: "POST",
          url: awsData.apiGatewayUrl + '/file_data',
          contentType: "text/json",
          dataType: 'json',
          data: JSON.stringify({ "content": file, "id": unique_id }),
          success: function (result) {
            return callback(result);
          },
          error: function (err) {
            return callback(null);
          }
        });

      }
      // Chat functions

      function showChatBox() {
        ws = null
        chat_id = null
        chat_messages = []
        assitant_messages = []
        reset_chat_html = '<div class="d-flex flex-row justify-content-start">' +
          '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"' +
          ' alt="avatar 1" style="width: 45px; height: 100%;"> ' +
          '<div><p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">' +
          'Hello I am Claude V2' +
          '</p></div></div>'

        document.getElementById('conversations-box').innerHTML = reset_chat_html

      }

      function reset_agent_box(agent_type) {
        ws = null
        chat_id = null
        agent_prompt_flow = []
        text_val = ''
        if (agent_type == 'weather') {
          text_val = 'Welcome to Weather reporter'
        } else {
          text_val = 'Welcome to SunNSands room booking portal?'
        }
        reset_chat_html = '<div class="d-flex flex-row justify-content-start">' +
          '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp"' +
          ' alt="avatar 1" style="width: 45px; height: 100%;"> ' +
          '<div><p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">' +
          text_val +
          '</p></div></div>'

        document.getElementById(agent_type + '-conversations-box').innerHTML = reset_chat_html
      }

      function guidGenerator() {
        var S4 = function () {
          return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        };
        return (S4() + S4() + "-" + S4());
      }

      chat_messages = [{ 'Assistant': 'Hello How may I help you today' }]

      assitant_messages = []

      function sendChat(assistant_type) {
        $('#send-chat-button').prop('disabled', true)
        $('#custom-spinner').css('visibility', 'visible');
        $('#index-button').css('visibility', 'hidden');
        $('#query-button').css('visibility', 'hidden');
        $('#delete-button').css('visibility', 'hidden');
        var message_store = '';
        var end_of_response = false;
        chat_id = guidGenerator()

        hard_coded_model = 'anthropic.claude-v2'
        query_str = " " + $('#chat-text').val()

        if (assitant_messages.length > 0) {
          chat_messages.push({ 'Assistant': assitant_messages.join(' ') })
          assitant_messages = []
        }

        chat_messages.push({ 'Human': query_str })

        data = '{"query": "' + btoa(unescape(JSON.stringify(chat_messages))) + '",  "behaviour": "' + assistant_type + '", "model_id": "' + hard_coded_model + '" ,"action": "bedrock"}'

        request_html = '<div class="d-flex flex-row justify-content-start">' +
          '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">' +
          '<div><p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">' +
          query_str +
          '</p></div></div>' +
          '<div class="divider d-flex align-items-center mb-4"></div>'
        document.getElementById('conversations-box').innerHTML = document.getElementById('conversations-box').innerHTML + request_html

        claude_wait_id = "claude-wait" + chat_id
        claude_wait_html = '<div id="' + claude_wait_id + '" class="d-flex flex-row justify-content-start">' +
          '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">' +
          '<div><p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">' +
          '...' +
          '</p></div></div>' +
          '<div class="divider d-flex align-items-center mb-4"></div>'
        document.getElementById('conversations-box').innerHTML = document.getElementById('conversations-box').innerHTML + claude_wait_html


        $(document).on('click', '#' + claude_wait_id, function () {
          $(this).removeClass('d-flex');
          $(this).hide();
          $(this).css('visibility', 'hidden');
        });

        if ("WebSocket" in window) {
          console.log("WebSocket is supported by your Browser!");
          if (ws == null || ws.readyState == 3 || ws.readyState == 2) {

            ws = new WebSocket(awsData.websocketUrl + '?x-api-key=' + awsData['apiKey']);
            ws.onerror = function (event) {
              console.log(event);
              $('#custom-spinner').css('visibility', 'hidden');
              $('#send-chat-button').prop('disabled', false)
              $('#index-button').css('visibility', 'visible');
              $('#query-button').css('visibility', 'visible');
              $('#delete-button').css('visibility', 'visible');
              alertbuilder('Could not establish connection. Either Incorrect key or exceeded usage limits', false)
            }

          } else {
            ws.send(data);
          }

          ws.onopen = function () {
            ws.send(data);
          }
        }

        ws.onmessage = function (evt) {
          $('#custom-spinner').css('visibility', 'hidden');
          $('#index-button').css('visibility', 'visible');
          $('#query-button').css('visibility', 'visible');
          $('#delete-button').css('visibility', 'visible');
          var received_msg = '';
          response_json = {}
          try {
            response_json = JSON.parse(atob(evt.data))
          }
          catch (error) {
            console.log(error)
          }

          if ("text" in response_json) {
            str_len = -1
            try {
              str_len = response_json['text'].trim().length
            } catch (error) {
              console.log('str_len error')
            }
            if (str_len != 0) {
              received_msg = response_json['text']
              if (received_msg == 'ack-end-of-string') {
                end_of_response = true
              }
              else {
                ascii_string = specialToASCII(received_msg)
                assitant_messages.push(ascii_string)
                message_store = message_store + received_msg
              }
            }
          } else {
            received_msg = JSON.stringify(response_json)
            message_store = message_store + received_msg
            end_of_response = true
          }
          console.log("streaming message is received.. " + received_msg);
          if (end_of_response) {
            response_html = '<div class="d-flex flex-row justify-content-start">' +
              '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">' +
              '<div><p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">' +
              message_store +
              '</p></div></div>' +
              '<div class="divider d-flex align-items-center mb-4"></div>'

            $("#" + claude_wait_id).trigger("click");
            $('#send-chat-button').prop('disabled', false)
            setTimeout(() => {
              document.getElementById('conversations-box').innerHTML = document.getElementById('conversations-box').innerHTML + response_html
            }, 2);
            message_store = ''
            end_of_response = false
          }


        }

      }


      agent_prompt_flow = []

      function invokeAgent(agent_type) {
        $('#send-chat-button').prop('disabled', true)
        $('#custom-spinner').css('visibility', 'visible');
        $('#index-button').css('visibility', 'hidden');
        $('#delete-button').css('visibility', 'hidden');
        var message_store = '';
        var end_of_response = false;
        chat_id = guidGenerator()
        var bg_color = "#cfa6cd"
        var inner_bg_color = "#e9dae8"
        query_str = " " + $('#' + agent_type + '-chat-text').val()

        human_prompt = { 'type': 'text', 'text': query_str }

        agent_prompt_flow.push({ 'role': 'user', 'content': [human_prompt] })

        data = '{"query": "' + btoa(unescape(JSON.stringify(agent_prompt_flow))) + '",  "behaviour": "' + agent_type + '-agent' + '" ,"action": "bedrock"}'

        request_html = '<div class="d-flex flex-row justify-content-start">' +
          '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">' +
          '<div><p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #f5f6f7;">' +
          query_str +
          '</p></div></div>' +
          '<div class="divider d-flex align-items-center mb-4"></div>'
        document.getElementById(agent_type + '-conversations-box').innerHTML = document.getElementById(agent_type + '-conversations-box').innerHTML + request_html

        claude_wait_id = "claude-wait" + chat_id
        claude_wait_html = '<div id="' + claude_wait_id + '" class="d-flex flex-row justify-content-start">' +
          '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">' +
          '<div style="background-color:' + bg_color + ';" >'
        '<p class="small p-2 ms-3 mb-1 rounded-3" style="background-color:' + inner_bg_color + ';">' +
          '... Thinking ...' +
          '</p></div></div>' +
          '<div class="divider d-flex align-items-center mb-4"></div>'
        document.getElementById(agent_type + '-conversations-box').innerHTML = document.getElementById(agent_type + '-conversations-box').innerHTML + claude_wait_html


        $(document).on('click', '#' + claude_wait_id, function () {
          $(this).removeClass('d-flex');
          $(this).hide();
          $(this).css('visibility', 'hidden');
        });

        if ("WebSocket" in window) {
          console.log("WebSocket is supported by your Browser!");
          if (ws == null || ws.readyState == 3 || ws.readyState == 2) {

            ws = new WebSocket(awsData.websocketUrl + '?x-api-key=' + awsData['apiKey']);
            ws.onerror = function (event) {
              agent_prompt_flow = [];
              console.log(event);
              $('#custom-spinner').css('visibility', 'hidden');
              $('#send-chat-button').prop('disabled', false)
              $('#index-button').css('visibility', 'visible');
              $('#query-button').css('visibility', 'visible');
              $('#delete-button').css('visibility', 'visible');
              alertbuilder('Could not establish connection. Either Incorrect key or exceeded usage limits', false)
            }

          } else {
            ws.send(data);
          }

          ws.onopen = function () {
            ws.send(data);
          }
        }

        ws.onmessage = function (evt) {
          $('#custom-spinner').css('visibility', 'hidden');
          $('#index-button').css('visibility', 'visible');
          $('#query-button').css('visibility', 'visible');
          $('#delete-button').css('visibility', 'visible');
          var received_msg = '';
          var thought = ''
          response_json = {}
          is_done = false
          bg_color = "#cfa6cd"
          inner_bg_color = "#e9dae8"
          try {
            response_details = JSON.parse(atob(evt.data))
            if ('prompt_flow' in response_details) {
              is_done = Boolean(response_details['done'])
              if (!is_done) {
                agent_prompt_flow = []
                for (var k = 0; k < response_details['prompt_flow'].length; k++) {
                  var prompt_content_list = response_details['prompt_flow'][k]['content']
                  content = []
                  for (var j = 0; j < prompt_content_list.length; j++) {
                    if ('text' in prompt_content_list[j]) {
                      txt = specialToASCII(prompt_content_list[j]['text'])
                      content.push({ "type": "text", "text": txt })
                    } else {
                      content.push(prompt_content_list[j])
                    }
                  }
                  agent_prompt_flow.push({ "role": response_details['prompt_flow'][k]['role'], "content": content })
                }

                for (var i = 0; i < response_details['prompt_flow'].length; i++) {
                  if ('content' in response_details['prompt_flow'][i]) {
                    content_list = response_details['prompt_flow'][i]['content']
                    for (var j = 0; j < content_list.length; j++) {
                      if ('text' in content_list[j]) {
                        thought = thought + '<br>' + capitalizeFirstLetter(response_details['prompt_flow'][i]['role']) + ': ' + content_list[j]['text']
                      } else {
                        thought = thought + '<br>' + capitalizeFirstLetter(response_details['prompt_flow'][i]['role']) + ': ' + content_list[j]
                      }
                    }
                  }
                }
              } else {
                if (response_details['prompt_flow'].length > 0) {
                  last_element = response_details['prompt_flow'][response_details['prompt_flow'].length - 1]
                  if ('content' in last_element) {
                    content_list = last_element['content']
                    content = []
                    for (var j = 0; j < content_list.length; j++) {
                      if ('text' in content_list[j]) {
                        content.push({ "type": "text", "text": specialToASCII(content_list[j]['text']) })
                        thought = thought + '<br>' + capitalizeFirstLetter(last_element['role']) + ': ' + content_list[j]['text']
                      } else {
                        content.push(content_list[j])
                        thought = thought + '<br>' + capitalizeFirstLetter(last_element['role']) + ': ' + content_list[j]
                      }
                    }
                    agent_prompt_flow.push({ "role": last_element['role'], "content": content })
                  }
                }
              }
            }
          } catch (error) {
            agent_prompt_flow = []
            // response_json = JSON.parse(evt.data)
            thought = evt.data
          }


          console.log("streaming message is received.. " + thought);

          if (is_done) {
            bg_color = "#a0cf5d"
            inner_bg_color = "#dcf1bd"
          } else {
            thought = '<b>Thought:</b><br>' + thought
          }
          response_html = '<div class="d-flex flex-row justify-content-start", style="background-color:' + bg_color + ' ;border-radius: 15px;">' +
            '<img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3-bg.webp" alt="avatar 1" style="width: 45px; height: 100%;">' +
            '<div style="background-color:' + inner_bg_color + ';" >' +
            '<p class="small p-2 ms-3 mb-1 rounded-3">' +
            thought +
            '</p></div></div>' +
            '<div class="divider d-flex align-items-center mb-4"></div>'

          $("#" + claude_wait_id).trigger("click");
          $('#send-chat-button').prop('disabled', false)
          setTimeout(() => {
            document.getElementById(agent_type + '-conversations-box').innerHTML = document.getElementById(agent_type + '-conversations-box').innerHTML + response_html
          }, 2);
          thought = ''
          end_of_response = false



        }

      }

      function capitalizeFirstLetter(val) {
        return val.charAt(0).toUpperCase() + val.slice(1);
      }

      function specialToASCII(data_str) {
        let res = '';
        for (let i = 0; i < data_str.length; i++) {
          if (data_str[i].charCodeAt(0) < 128) {
            res += data_str[i];
            continue;
          };
          res += '<special_char>' + data_str[i].charCodeAt(0) + '</special_char>';
        };
        return res;
      };

      function agentworkflow(div_id) {
        $('[id^=agent-]').hide()
        $('#' + div_id).show()
      }
    </script>


  </footer>

</body>

</html>